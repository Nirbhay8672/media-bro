import{d as me,p as C,c as K,a as _,o as S,b as A,f as n,e as $,h as be,g as re,k as te,F as oe,r as pe,t as z,y as xe,n as R,D as we,E as ke}from"./app-UJKdXCNU.js";import{S as q}from"./sweetalert2.esm.all-Bj_ZQUAw.js";import{T as Pe,U as _e}from"./upload-D2WhNdLu.js";import{I as ge,a as Se,C as Ce,X as Ee}from"./x-CIgFLPX8.js";import{c as ae}from"./createLucideIcon-5navPibp.js";import{P as Ie}from"./plus-BGy2dw44.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=ae("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ae("ChevronUpIcon",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=ae("DownloadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ae("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var he={exports:{}},ve;function Me(){return ve||(ve=1,(function(ne){(function(w){var y=ce(),B=ue(),Y=x(),N=de(),X={imagePlaceholder:void 0,cacheBust:!1},m={toSvg:H,toPng:se,toJpeg:Z,toBlob:V,toPixelData:ye,impl:{fontFaces:Y,images:N,util:y,inliner:B,options:{}}};ne.exports=m;function H(s,a){return a=a||{},G(a),Promise.resolve(s).then(function(c){return L(c,a.filter,!0)}).then(Q).then(ie).then(i).then(function(c){return le(c,a.width||y.width(s),a.height||y.height(s))});function i(c){return a.bgcolor&&(c.style.backgroundColor=a.bgcolor),a.width&&(c.style.width=a.width+"px"),a.height&&(c.style.height=a.height+"px"),a.style&&Object.keys(a.style).forEach(function(f){c.style[f]=a.style[f]}),c}}function ye(s,a){return W(s,a||{}).then(function(i){return i.getContext("2d").getImageData(0,0,y.width(s),y.height(s)).data})}function se(s,a){return W(s,a||{}).then(function(i){return i.toDataURL()})}function Z(s,a){return a=a||{},W(s,a).then(function(i){return i.toDataURL("image/jpeg",a.quality||1)})}function V(s,a){return W(s,a||{}).then(y.canvasToBlob)}function G(s){typeof s.imagePlaceholder>"u"?m.impl.options.imagePlaceholder=X.imagePlaceholder:m.impl.options.imagePlaceholder=s.imagePlaceholder,typeof s.cacheBust>"u"?m.impl.options.cacheBust=X.cacheBust:m.impl.options.cacheBust=s.cacheBust}function W(s,a){return H(s,a).then(y.makeImage).then(y.delay(100)).then(function(c){var f=i(s);return f.getContext("2d").drawImage(c,0,0),f});function i(c){var f=document.createElement("canvas");if(f.width=a.width||y.width(c),f.height=a.height||y.height(c),a.bgcolor){var g=f.getContext("2d");g.fillStyle=a.bgcolor,g.fillRect(0,0,f.width,f.height)}return f}}function L(s,a,i){if(!i&&a&&!a(s))return Promise.resolve();return Promise.resolve(s).then(c).then(function(l){return f(s,l,a)}).then(function(l){return g(s,l)});function c(l){return l instanceof HTMLCanvasElement?y.makeImage(l.toDataURL()):l.cloneNode(!1)}function f(l,p,E){var M=l.childNodes;if(M.length===0)return Promise.resolve(p);return k(p,y.asArray(M),E).then(function(){return p});function k(F,T,r){var t=Promise.resolve();return T.forEach(function(e){t=t.then(function(){return L(e,r)}).then(function(u){u&&F.appendChild(u)})}),t}}function g(l,p){if(!(p instanceof Element))return p;return Promise.resolve().then(E).then(M).then(k).then(F).then(function(){return p});function E(){T(window.getComputedStyle(l),p.style);function T(r,t){r.cssText?t.cssText=r.cssText:e(r,t);function e(u,b){y.asArray(u).forEach(function(o){b.setProperty(o,u.getPropertyValue(o),u.getPropertyPriority(o))})}}}function M(){[":before",":after"].forEach(function(r){T(r)});function T(r){var t=window.getComputedStyle(l,r),e=t.getPropertyValue("content");if(e===""||e==="none")return;var u=y.uid();p.className=p.className+" "+u;var b=document.createElement("style");b.appendChild(o(u,r,t)),p.appendChild(b);function o(d,v,h){var P="."+d+":"+v,I=h.cssText?j(h):J(h);return document.createTextNode(P+"{"+I+"}");function j(U){var D=U.getPropertyValue("content");return U.cssText+" content: "+D+";"}function J(U){return y.asArray(U).map(D).join("; ")+";";function D(O){return O+": "+U.getPropertyValue(O)+(U.getPropertyPriority(O)?" !important":"")}}}}}function k(){l instanceof HTMLTextAreaElement&&(p.innerHTML=l.value),l instanceof HTMLInputElement&&p.setAttribute("value",l.value)}function F(){p instanceof SVGElement&&(p.setAttribute("xmlns","http://www.w3.org/2000/svg"),p instanceof SVGRectElement&&["width","height"].forEach(function(T){var r=p.getAttribute(T);r&&p.style.setProperty(T,r)}))}}}function Q(s){return Y.resolveAll().then(function(a){var i=document.createElement("style");return s.appendChild(i),i.appendChild(document.createTextNode(a)),s})}function ie(s){return N.inlineAll(s).then(function(){return s})}function le(s,a,i){return Promise.resolve(s).then(function(c){return c.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(c)}).then(y.escapeXhtml).then(function(c){return'<foreignObject x="0" y="0" width="100%" height="100%">'+c+"</foreignObject>"}).then(function(c){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+i+'">'+c+"</svg>"}).then(function(c){return"data:image/svg+xml;charset=utf-8,"+c})}function ce(){return{escape:F,parseExtension:a,mimeType:i,dataAsUrl:k,isDataUrl:c,canvasToBlob:g,resolveUrl:l,getAndEncode:M,uid:p(),delay:T,asArray:r,escapeXhtml:t,makeImage:E,width:e,height:u};function s(){var o="application/font-woff",d="image/jpeg";return{woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:d,jpeg:d,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function a(o){var d=/\.([^\.\/]*?)$/g.exec(o);return d?d[1]:""}function i(o){var d=a(o).toLowerCase();return s()[d]||""}function c(o){return o.search(/^(data:)/)!==-1}function f(o){return new Promise(function(d){for(var v=window.atob(o.toDataURL().split(",")[1]),h=v.length,P=new Uint8Array(h),I=0;I<h;I++)P[I]=v.charCodeAt(I);d(new Blob([P],{type:"image/png"}))})}function g(o){return o.toBlob?new Promise(function(d){o.toBlob(d)}):f(o)}function l(o,d){var v=document.implementation.createHTMLDocument(),h=v.createElement("base");v.head.appendChild(h);var P=v.createElement("a");return v.body.appendChild(P),h.href=d,P.href=o,P.href}function p(){var o=0;return function(){return"u"+d()+o++;function d(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function E(o){return new Promise(function(d,v){var h=new Image;h.onload=function(){d(h)},h.onerror=v,h.src=o})}function M(o){var d=3e4;return m.impl.options.cacheBust&&(o+=(/\?/.test(o)?"&":"?")+new Date().getTime()),new Promise(function(v){var h=new XMLHttpRequest;h.onreadystatechange=j,h.ontimeout=J,h.responseType="blob",h.timeout=d,h.open("GET",o,!0),h.send();var P;if(m.impl.options.imagePlaceholder){var I=m.impl.options.imagePlaceholder.split(/,/);I&&I[1]&&(P=I[1])}function j(){if(h.readyState===4){if(h.status!==200){P?v(P):U("cannot fetch resource: "+o+", status: "+h.status);return}var D=new FileReader;D.onloadend=function(){var O=D.result.split(/,/)[1];v(O)},D.readAsDataURL(h.response)}}function J(){P?v(P):U("timeout of "+d+"ms occured while fetching resource: "+o)}function U(D){console.error(D),v("")}})}function k(o,d){return"data:"+d+";base64,"+o}function F(o){return o.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function T(o){return function(d){return new Promise(function(v){setTimeout(function(){v(d)},o)})}}function r(o){for(var d=[],v=o.length,h=0;h<v;h++)d.push(o[h]);return d}function t(o){return o.replace(/#/g,"%23").replace(/\n/g,"%0A")}function e(o){var d=b(o,"border-left-width"),v=b(o,"border-right-width");return o.scrollWidth+d+v}function u(o){var d=b(o,"border-top-width"),v=b(o,"border-bottom-width");return o.scrollHeight+d+v}function b(o,d){var v=window.getComputedStyle(o).getPropertyValue(d);return parseFloat(v.replace("px",""))}}function ue(){var s=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:f,shouldProcess:a,impl:{readUrls:i,inline:c}};function a(g){return g.search(s)!==-1}function i(g){for(var l=[],p;(p=s.exec(g))!==null;)l.push(p[1]);return l.filter(function(E){return!y.isDataUrl(E)})}function c(g,l,p,E){return Promise.resolve(l).then(function(k){return p?y.resolveUrl(k,p):k}).then(E||y.getAndEncode).then(function(k){return y.dataAsUrl(k,y.mimeType(l))}).then(function(k){return g.replace(M(l),"$1"+k+"$3")});function M(k){return new RegExp(`(url\\(['"]?)(`+y.escape(k)+`)(['"]?\\))`,"g")}}function f(g,l,p){if(E())return Promise.resolve(g);return Promise.resolve(g).then(i).then(function(M){var k=Promise.resolve(g);return M.forEach(function(F){k=k.then(function(T){return c(T,F,l,p)})}),k});function E(){return!a(g)}}}function x(){return{resolveAll:s,impl:{readAll:a}};function s(){return a().then(function(i){return Promise.all(i.map(function(c){return c.resolve()}))}).then(function(i){return i.join(`
`)})}function a(){return Promise.resolve(y.asArray(document.styleSheets)).then(c).then(i).then(function(g){return g.map(f)});function i(g){return g.filter(function(l){return l.type===CSSRule.FONT_FACE_RULE}).filter(function(l){return B.shouldProcess(l.style.getPropertyValue("src"))})}function c(g){var l=[];return g.forEach(function(p){try{y.asArray(p.cssRules||[]).forEach(l.push.bind(l))}catch(E){console.log("Error while reading CSS rules from "+p.href,E.toString())}}),l}function f(g){return{resolve:function(){var p=(g.parentStyleSheet||{}).href;return B.inlineAll(g.cssText,p)},src:function(){return g.style.getPropertyValue("src")}}}}}function de(){return{inlineAll:a,impl:{newImage:s}};function s(i){return{inline:c};function c(f){return y.isDataUrl(i.src)?Promise.resolve():Promise.resolve(i.src).then(f||y.getAndEncode).then(function(g){return y.dataAsUrl(g,y.mimeType(i.src))}).then(function(g){return new Promise(function(l,p){i.onload=l,i.onerror=p,i.src=g})})}}function a(i){if(!(i instanceof Element))return Promise.resolve(i);return c(i).then(function(){return i instanceof HTMLImageElement?s(i).inline():Promise.all(y.asArray(i.childNodes).map(function(f){return a(f)}))});function c(f){var g=f.style.getPropertyValue("background");return g?B.inlineAll(g).then(function(l){f.style.setProperty("background",l,f.style.getPropertyPriority("background"))}).then(function(){return f}):Promise.resolve(f)}}}})()})(he)),he.exports}var fe=Me();const De={class:"mx-auto px-4 py-6 sm:px-6 lg:px-8"},Re={class:"grid gap-6 lg:grid-cols-4"},Be={class:"lg:col-span-1"},Fe={class:"space-y-4 max-h-[calc(100vh-2rem)] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600"},je={key:0,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},Xe={class:"p-4 border-b border-gray-200 dark:border-gray-700"},We={class:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2"},Le={class:"p-4 space-y-4"},Oe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Ye=["onUpdate:modelValue","placeholder"],He={key:1,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},ze={class:"p-4 border-b border-gray-200 dark:border-gray-700"},Ne={class:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2"},Ve={class:"p-4"},qe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Ge={class:"space-y-2"},Je=["id","onChange"],Ke={key:0},Ze=["for"],Qe={class:"flex flex-col items-center justify-center py-3"},er={key:1,class:"relative group"},rr=["src","alt"],tr=["onClick"],or={key:2,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},ar={class:"p-4 border-b border-gray-200 dark:border-gray-700"},nr={class:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2"},sr={class:"p-4 space-y-4"},ir={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},lr={class:"flex items-center gap-3"},cr=["disabled"],ur={class:"flex-1"},dr=["value"],pr=["disabled"],gr={class:"space-y-2"},hr={class:"flex justify-center"},fr={class:"flex justify-center gap-2"},yr={class:"flex justify-center"},vr={class:"lg:col-span-3"},mr={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},br={class:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"},xr={class:"text-lg font-semibold text-gray-900 dark:text-white"},wr=["disabled"],kr={class:"p-4"},Pr={class:"flex justify-center items-start min-h-[400px]"},_r={class:"relative",style:{margin:"20px 0"}},Sr=["onMousedown"],Cr=["onMousedown"],Er=["src","alt","onClick","onMousedown"],Ir={key:1,class:"flex items-center justify-center text-gray-400 bg-gray-50 dark:bg-gray-800/50 w-full h-full"},Rr=me({__name:"Share",props:{template:{}},setup(ne){const w=ne,y=C(null),B=C(!1);C(!1),C("");const Y=C(null);C(10),C(0),C(0),C(1);const N=C(!1),X=C({x:0,y:0,posX:0,posY:0}),m=C(null),H=C([]);(()=>{let r;if(Array.isArray(w.template.canvas_data))r=w.template.canvas_data;else if(typeof w.template.canvas_data=="string")try{r=JSON.parse(w.template.canvas_data)}catch{r=[]}else r=[];r.filter(e=>e.type==="image").length>0,H.value=r.map(e=>({...e,properties:{text:e.properties?.text||"",fontSize:e.properties?.fontSize||16,fontFamily:e.properties?.fontFamily||"Arial",fontWeight:e.properties?.fontWeight||"normal",fontStyle:e.properties?.fontStyle||"normal",textDecoration:e.properties?.textDecoration||"none",textAlign:e.properties?.textAlign||"left",lineHeight:e.properties?.lineHeight||1.2,color:e.properties?.color||"#000000",backgroundColor:e.properties?.backgroundColor||(e.type==="text"?"transparent":"#f3f4f6"),hasBorder:e.properties?.hasBorder||!1,borderWidth:e.properties?.borderWidth||1,borderColor:e.properties?.borderColor||"#000000",borderStyle:e.properties?.borderStyle||"solid",borderRadius:e.properties?.borderRadius||0,boxShadow:e.properties?.boxShadow||"none",textShadow:e.properties?.textShadow||"none",imageUrl:e.properties?.imageUrl||"",imageFit:e.properties?.imageFit||"cover",imagePlaceholder:e.properties?.imagePlaceholder||(e.type==="image",""),imageShape:e.properties?.imageShape||"rectangle"}}))})();const se=K(()=>[...H.value].sort((r,t)=>r.zIndex-t.zIndex)),Z=K(()=>H.value.filter(r=>r.type==="text")),V=K(()=>H.value.filter(r=>r.type==="image")),G=C(!1),W=C({x:0,y:0}),L=C(null),Q=(r,t)=>{y.value=t,t.type!=="image"&&(m.value=null),t.type==="text"&&(r.preventDefault(),G.value=!0,W.value={x:r.clientX-t.x*x.value,y:r.clientY-t.y*x.value},L.value=t)},ie=r=>{G.value&&L.value&&(L.value.x=(r.clientX-W.value.x)/x.value,L.value.y=(r.clientY-W.value.y)/x.value)},le=r=>{G.value=!1,L.value=null},ce=r=>{switch(r){case"circle":return"circle(50% at 50% 50%)";case"triangle":return"polygon(50% 0%, 0% 100%, 100% 100%)";case"star":return"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)";case"diamond":return"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)";case"hexagon":return"polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)";case"octagon":return"polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)";case"rectangle":default:return"none"}},ue=K(()=>{const e=800/w.template.width,u=600/w.template.height,b=Math.min(e,u,1),o=w.template.width*b,d=w.template.height*b;return{width:o+"px",height:d+"px",transform:"none",backgroundImage:w.template.background_image_url?`url(${w.template.background_image_url})`:w.template.background_image?`url(/storage/${w.template.background_image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative"}}),x=K(()=>{const e=800/w.template.width,u=600/w.template.height;return Math.min(e,u,1)}),de=(r,t)=>{const e=r.target.files?.[0];if(!e)return;if(!e.type.startsWith("image/")){alert("Please select a valid image file.");return}if(e.size>10*1024*1024){alert("File size must be less than 10MB.");return}const u=URL.createObjectURL(e);t.properties.imageUrl=u,t.properties.cropScale||(t.properties.cropScale=10),t.properties.cropPositionX||(t.properties.cropPositionX=0),t.properties.cropPositionY||(t.properties.cropPositionY=0),t.uploadedFile=e},s=r=>{const t=r.properties.cropScale||0,e=Math.min(t+1,200);r.properties.cropScale=e},a=r=>{const t=r.properties.cropScale||0,e=Math.max(t-1,0);r.properties.cropScale=e},i=(r,t)=>{r.properties.cropScale=Math.max(0,Math.min(200,t))},c=(r,t)=>{r.stopPropagation(),m.value=t},f=(r,t)=>{r.stopPropagation(),N.value=!0,Y.value=t,m.value=t,X.value={x:r.clientX,y:r.clientY,posX:t.properties.cropPositionX||0,posY:t.properties.cropPositionY||0}},g=r=>{if(!N.value||!Y.value)return;const t=r.clientX-X.value.x,e=r.clientY-X.value.y,u=X.value.posX+t/x.value,b=X.value.posY+e/x.value;Y.value.properties.cropPositionX=u,Y.value.properties.cropPositionY=b},l=()=>{N.value=!1},p=r=>{const t=r.properties.cropPositionY||0;r.properties.cropPositionY=t-10},E=r=>{const t=r.properties.cropPositionY||0;r.properties.cropPositionY=t+10},M=r=>{const t=r.properties.cropPositionX||0;r.properties.cropPositionX=t-10},k=r=>{const t=r.properties.cropPositionX||0;r.properties.cropPositionX=t+10},F=r=>{r.properties.imageUrl&&r.properties.imageUrl.startsWith("blob:")&&URL.revokeObjectURL(r.properties.imageUrl),r.properties.imageUrl="",r.uploadedFile=null},T=async()=>{B.value=!0,q.fire({title:"Generating Image...",text:"Please wait while we create your image.",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{q.showLoading()}});try{const r=document.querySelector(".template-preview-container");if(!r)throw new Error("Preview container not found");await(async()=>{const P=r.querySelectorAll("img"),I=Array.from(P).map(async(j,J)=>{if(j.src.startsWith("blob:"))try{const U=await fetch(j.src);if(!U.ok)throw new Error(`HTTP ${U.status}: ${U.statusText}`);const D=await U.blob();return new Promise(O=>{const ee=new FileReader;ee.onload=()=>{j.src=ee.result,O(!0)},ee.onerror=()=>{O(!1)},ee.readAsDataURL(D)})}catch{return!1}else return!0});await Promise.all(I)})();let e;const u=w.template.width*x.value,b=w.template.height*x.value,o=w.template.width,d=w.template.height;try{const I=u*6,j=b*6;e=await fe.toJpeg(r,{quality:1,bgcolor:"#ffffff",width:I,height:j,style:{transform:"scale(6)",transformOrigin:"top left",width:u+"px",height:b+"px",imageRendering:"crisp-edges"},pixelRatio:6,cacheBust:!0,filter:J=>!0,useCORS:!0,allowTaint:!0})}catch{try{e=await fe.toJpeg(r,{quality:1,bgcolor:"#ffffff",width:u*4,height:b*4,style:{transform:"scale(4)",transformOrigin:"top left",width:u+"px",height:b+"px"},pixelRatio:4,cacheBust:!0,useCORS:!0})}catch{e=await fe.toJpeg(r,{quality:1,bgcolor:"#ffffff",width:u,height:b,pixelRatio:3,cacheBust:!0})}}const v=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),h=document.createElement("a");h.href=e,h.download=`${w.template.name}_${v}.jpg`,document.body.appendChild(h),h.click(),document.body.removeChild(h);try{const P=await fetch(`/template/${w.template.share_token}/track-download`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({file_name:`${w.template.name}_${v}.jpg`,file_size:e.length})})}catch{}q.close(),q.fire({icon:"success",title:"Download Complete!",text:"Your image has been downloaded successfully.",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(r){q.close();let t="Unknown error occurred while generating image.";r.message?t=r.message:r.name==="SecurityError"?t="Security error: Cannot access the preview element. Please try refreshing the page.":r.name==="InvalidStateError"?t="Invalid state error: The preview element may not be ready. Please try again.":r.toString().includes("canvas")&&(t="Canvas rendering error: Please check if all images are loaded and try again."),q.fire({icon:"error",title:"Download Failed",text:t,confirmButtonText:"Try Again"})}finally{B.value=!1}};return(r,t)=>(S(),_(oe,null,[A($(be),{title:r.template.name},null,8,["title"]),n("div",{class:"min-h-screen bg-gray-50 dark:bg-gray-900",onMouseup:l,onMousemove:g},[n("div",De,[n("div",Re,[n("div",Be,[n("div",Fe,[Z.value.length>0?(S(),_("div",je,[n("div",Xe,[n("h2",We,[A($(Pe),{class:"h-5 w-5"}),t[7]||(t[7]=te(" Text Content ",-1))])]),n("div",Le,[(S(!0),_(oe,null,pe(Z.value,(e,u)=>(S(),_("div",{key:e.id,class:"space-y-2"},[n("label",Oe," Text "+z(u+1),1),we(n("textarea",{"onUpdate:modelValue":b=>e.properties.text=b,rows:"2",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors text-sm",placeholder:`Enter text ${u+1}`},null,8,Ye),[[ke,e.properties.text]])]))),128))])])):re("",!0),V.value.length>0?(S(),_("div",He,[n("div",ze,[n("h2",Ne,[A($(ge),{class:"h-5 w-5"}),te(" Image Upload ("+z(V.value.length)+") ",1)])]),n("div",Ve,[n("div",{class:xe(["grid gap-3",V.value.length>3?"grid-cols-2":"grid-cols-1"])},[(S(!0),_(oe,null,pe(V.value,(e,u)=>(S(),_("div",{key:e.id,class:"space-y-2"},[n("label",qe," Image "+z(u+1),1),n("div",Ge,[n("input",{id:`image-${e.id}`,type:"file",accept:"image/*",onChange:b=>de(b,e),class:"hidden"},null,40,Je),e.properties.imageUrl?(S(),_("div",er,[n("img",{src:e.properties.imageUrl,alt:`Image ${u+1}`,class:"w-full h-20 object-cover rounded-lg border border-gray-300 dark:border-gray-600"},null,8,rr),n("button",{type:"button",onClick:b=>F(e),class:"absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100"},[A($(Ee),{class:"w-3 h-3"})],8,tr)])):(S(),_("div",Ke,[n("label",{for:`image-${e.id}`,class:"flex flex-col items-center justify-center w-full h-20 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600"},[n("div",Qe,[A($(_e),{class:"w-5 h-5 mb-1 text-gray-500 dark:text-gray-400"}),t[8]||(t[8]=n("p",{class:"text-xs text-gray-500 dark:text-gray-400"},[n("span",{class:"font-semibold"},"Upload")],-1))])],8,Ze)]))])]))),128))],2)])])):re("",!0),m.value&&m.value.properties.imageUrl?(S(),_("div",or,[n("div",ar,[n("h2",nr,[A($(ge),{class:"h-5 w-5"}),t[9]||(t[9]=te(" Image Controls ",-1))])]),n("div",sr,[n("div",null,[n("label",ir," Zoom: "+z(m.value.properties.cropScale||0)+"% ",1),n("div",lr,[n("button",{onClick:t[0]||(t[0]=e=>a(m.value)),class:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",disabled:(m.value.properties.cropScale||0)<=0},[A($($e),{class:"w-4 h-4"})],8,cr),n("div",ur,[n("input",{type:"range",value:m.value.properties.cropScale||0,onInput:t[1]||(t[1]=e=>i(m.value,parseFloat(e.target.value))),min:"0",max:"200",step:"1",class:"w-full"},null,40,dr)]),n("button",{onClick:t[2]||(t[2]=e=>s(m.value)),class:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",disabled:(m.value.properties.cropScale||0)>=200},[A($(Ie),{class:"w-4 h-4"})],8,pr)])]),n("div",null,[t[10]||(t[10]=n("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Position ",-1)),n("div",gr,[n("div",hr,[n("button",{onClick:t[3]||(t[3]=e=>p(m.value)),class:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Move Up"},[A($(Te),{class:"w-4 h-4"})])]),n("div",fr,[n("button",{onClick:t[4]||(t[4]=e=>M(m.value)),class:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Move Left"},[A($(Ue),{class:"w-4 h-4"})]),n("button",{onClick:t[5]||(t[5]=e=>k(m.value)),class:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Move Right"},[A($(Se),{class:"w-4 h-4"})])]),n("div",yr,[n("button",{onClick:t[6]||(t[6]=e=>E(m.value)),class:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Move Down"},[A($(Ce),{class:"w-4 h-4"})])])])])])])):re("",!0)])]),n("div",vr,[n("div",mr,[n("div",br,[n("h2",xr,z(r.template.name),1),n("button",{onClick:T,disabled:B.value,class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50"},[A($(Ae),{class:"h-4 w-4"}),te(" "+z(B.value?"Generating...":"Download Image"),1)],8,wr)]),n("div",kr,[n("div",Pr,[n("div",_r,[n("div",{class:"template-preview-container relative overflow-hidden bg-gray-50 dark:bg-gray-700 shadow-lg",style:R(ue.value),onMousemove:ie,onMouseup:le},[(S(!0),_(oe,null,pe(se.value,e=>(S(),_("div",{key:e.id,class:"absolute",style:R({left:e.x*x.value+"px",top:e.y*x.value+"px",width:e.width*x.value+"px",height:e.height*x.value+"px",zIndex:e.zIndex,transform:`rotate(${e.rotation}deg)`,filter:e.properties.boxShadow!=="none"?`drop-shadow(${e.properties.boxShadow})`:"none"})},[e.type==="text"?(S(),_("div",{key:0,class:"w-full h-full flex items-center justify-center cursor-move select-none",style:R({color:e.properties.color,backgroundColor:e.properties.backgroundColor,fontSize:e.properties.fontSize*x.value+"px",fontFamily:e.properties.fontFamily,fontWeight:e.properties.fontWeight,fontStyle:e.properties.fontStyle,textDecoration:e.properties.textDecoration,textAlign:e.properties.textAlign,lineHeight:e.properties.lineHeight,border:e.properties.hasBorder?`${e.properties.strokeWidth*x.value}px ${e.properties.borderStyle} ${e.properties.strokeColor}`:"none",borderRadius:e.properties.borderRadius*x.value+"px",padding:8*x.value+"px",boxSizing:"border-box",wordWrap:"break-word",overflow:"hidden"}),onMousedown:u=>Q(u,e)},z(e.properties.text||"Your text here"),45,Sr)):e.type==="image"?(S(),_("div",{key:1,class:"w-full h-full flex items-center justify-center overflow-hidden relative group",style:R({backgroundColor:e.properties.backgroundColor||"transparent",border:e.properties.hasBorder?`${e.properties.strokeWidth*x.value}px ${e.properties.borderStyle} ${e.properties.strokeColor}`:"none",borderRadius:e.properties.imageShape==="rectangle"?(e.properties.borderRadius||0)*x.value+"px":"0px",clipPath:ce(e.properties.imageShape||"rectangle")}),onMousedown:u=>Q(u,e)},[e.properties.imageUrl?(S(),_("img",{key:0,src:e.properties.imageUrl,alt:e.properties.imagePlaceholder,class:"absolute cursor-move select-none",style:R({width:"auto",height:"auto",maxWidth:"none",maxHeight:"none",objectFit:"none",transform:`translate(-50%, -50%) scale(${Math.max(e.properties.cropScale||0,1)/100}) translate(${(e.properties.cropPositionX||0)*x.value}px, ${(e.properties.cropPositionY||0)*x.value}px)`,top:"50%",left:"50%",transformOrigin:"center"}),onClick:u=>c(u,e),onMousedown:u=>f(u,e)},null,44,Er)):(S(),_("div",Ir,[A($(ge),{class:"opacity-60",style:R({width:Math.min(e.width*x.value*.4,32)+"px",height:Math.min(e.height*x.value*.4,32)+"px"})},null,8,["style"])]))],44,Cr)):e.type==="rectangle"?(S(),_("div",{key:2,class:"w-full h-full",style:R({backgroundColor:e.properties.fillColor||"#ffffff",border:e.properties.hasBorder?`${e.properties.strokeWidth}px ${e.properties.borderStyle} ${e.properties.strokeColor}`:"none",borderRadius:(e.properties.borderRadius||0)+"px"})},null,4)):e.type==="circle"?(S(),_("div",{key:3,class:"w-full h-full rounded-full",style:R({backgroundColor:e.properties.fillColor||"#ffffff",border:e.properties.hasBorder?`${e.properties.strokeWidth}px ${e.properties.borderStyle} ${e.properties.strokeColor}`:"none"})},null,4)):e.type==="triangle"?(S(),_("div",{key:4,class:"w-full h-full",style:R({backgroundColor:e.properties.fillColor||"#ffffff",border:e.properties.hasBorder?`${e.properties.strokeWidth}px ${e.properties.borderStyle} ${e.properties.strokeColor}`:"none",clipPath:"polygon(50% 0%, 0% 100%, 100% 100%)"})},null,4)):e.type==="star"?(S(),_("div",{key:5,class:"w-full h-full",style:R({backgroundColor:e.properties.fillColor||"#ffffff",border:e.properties.hasBorder?`${e.properties.strokeWidth}px ${e.properties.borderStyle} ${e.properties.strokeColor}`:"none",clipPath:"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)"})},null,4)):re("",!0)],4))),128))],36)])])])])])])])],32)],64))}});export{Rr as default};
