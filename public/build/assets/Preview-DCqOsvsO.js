import{d as O,j as D,c as N,a as c,o as d,b as s,e as o,h as T,w as a,f as r,p as u,t as v,F as S,r as V,s as z,x as G,i as M,g as H,B as J}from"./app-mDDMLug4.js";import{_ as K}from"./AppLayout.vue_vue_type_script_setup_true_lang-BMBf6Jb5.js";import{_ as g}from"./index-5T4qJJOw.js";import{_ as F,a as C,b as A,d as U,c as L}from"./CardTitle.vue_vue_type_script_setup_true_lang-BiCR9QuY.js";import{c as q}from"./createLucideIcon-s0rQ-tjY.js";import{D as $}from"./download-DHgl88BE.js";import"./useAssets-CQmDLjgb.js";import"./useForwardExpose-Dc5V3_WQ.js";import"./VisuallyHidden-M1x2NXyA.js";import"./RovingFocusGroup-BTeHOHaD.js";import"./x-_bimYh2h.js";import"./index-DK8P9mNh.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./loader-circle-CeruoUBO.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=q("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Q={class:"h-[calc(100vh-4rem)] flex flex-col p-4"},W={class:"flex items-center justify-between mb-4 flex-shrink-0"},X={class:"flex items-center gap-4"},Y={class:"flex items-center gap-2"},Z={key:0,class:"flex-1 flex items-center justify-center"},ee={key:1,class:"flex-1 flex gap-4 overflow-hidden min-h-0"},te={key:0,class:"text-center py-8 text-gray-500"},le={key:1,class:"space-y-2"},se=["onClick"],oe={class:"flex items-center justify-between"},ae={class:"flex-1 min-w-0"},re={class:"text-sm font-medium truncate"},ne={class:"text-xs text-gray-500 mt-1"},de={class:"flex-1 min-w-0 overflow-hidden"},ie={key:0,class:"flex items-center justify-center h-full text-gray-500"},ce={key:1,class:"border rounded-lg overflow-hidden bg-white"},ue={class:"aspect-[1/1.414] w-full",style:{"min-height":"600px"}},fe=["src"],me=["src"],pe=["data"],ve={class:"flex items-center justify-center h-full text-gray-500"},be=["href","download"],he={key:3,class:"flex items-center justify-center h-full text-red-500"},Ne=O({__name:"Preview",props:{pdfs:{},timestamp:{}},setup(B){const y=B,_=D([]);(()=>{try{const t=sessionStorage.getItem("current_pdfs_key");if(t){const e=localStorage.getItem(t);if(e){const l=JSON.parse(e);if(l.pdfs&&Array.isArray(l.pdfs)){_.value=l.pdfs,console.log("PDFs loaded from localStorage:",_.value.length),localStorage.removeItem(t),sessionStorage.removeItem("current_pdfs_key");return}}}}catch(t){console.error("Error loading PDFs from localStorage:",t)}y.pdfs&&y.pdfs.length>0&&(_.value=y.pdfs,console.log("PDFs loaded from props:",_.value.length))})();const n=N(()=>_.value.length>0?_.value:y.pdfs||[]);console.log("Preview page loaded:",{pdfs_from_props:y.pdfs?.length||0,pdfs_loaded:n.value.length});const w=D(0),i=N(()=>n.value[w.value]||n.value[0]||null),b=D(null);if(i.value?.base64)try{const t=i.value.base64.trim();if(t&&t.length>0){const e=atob(t),l=new Array(e.length);for(let p=0;p<e.length;p++)l[p]=e.charCodeAt(p);const f=new Uint8Array(l),h=new Blob([f],{type:"application/pdf"});b.value=URL.createObjectURL(h)}}catch(t){console.error("Error creating blob URL:",t)}const R=t=>{if(b.value&&(URL.revokeObjectURL(b.value),b.value=null),t?.base64)try{const e=t.base64.trim();if(e&&e.length>0){const l=atob(e),f=new Array(l.length);for(let m=0;m<l.length;m++)f[m]=l.charCodeAt(m);const h=new Uint8Array(f),p=new Blob([h],{type:"application/pdf"});b.value=URL.createObjectURL(p)}}catch(e){console.error("Error creating blob URL:",e)}},E=t=>{w.value=t,R(n.value[t])},P=t=>{try{const e=atob(t.base64),l=new Array(e.length);for(let x=0;x<e.length;x++)l[x]=e.charCodeAt(x);const f=new Uint8Array(l),h=new Blob([f],{type:"application/pdf"}),p=URL.createObjectURL(h),m=document.createElement("a");m.href=p,m.download=t.filename,document.body.appendChild(m),m.click(),document.body.removeChild(m),setTimeout(()=>URL.revokeObjectURL(p),100)}catch(e){console.error("Error downloading PDF:",e);const l=document.createElement("a");l.href=`data:application/pdf;base64,${t.base64}`,l.download=t.filename,document.body.appendChild(l),l.click(),document.body.removeChild(l)}},I=async()=>{for(let t=0;t<n.value.length;t++)P(n.value[t]),t<n.value.length-1&&await new Promise(e=>setTimeout(e,200))},k=()=>{J.visit("/pdf-templates")};return(t,e)=>(d(),c(S,null,[s(o(T),{title:"PDF Preview"}),s(K,null,{default:a(()=>[r("div",Q,[r("div",W,[r("div",X,[s(o(g),{variant:"outline",onClick:k},{default:a(()=>[s(o(j),{class:"mr-2 h-4 w-4"}),e[3]||(e[3]=u(" Back ",-1))]),_:1}),e[4]||(e[4]=r("div",null,[r("h1",{class:"text-2xl font-semibold"},"PDF Preview"),r("p",{class:"text-sm text-gray-500"},"Preview and download generated PDFs")],-1))]),r("div",Y,[s(o(g),{variant:"outline",onClick:e[0]||(e[0]=l=>P(i.value)),disabled:!i.value},{default:a(()=>[s(o($),{class:"mr-2 h-4 w-4"}),e[5]||(e[5]=u(" Download Current PDF ",-1))]),_:1},8,["disabled"]),s(o(g),{onClick:I,disabled:n.value.length===0},{default:a(()=>[s(o($),{class:"mr-2 h-4 w-4"}),u(" Download All PDFs ("+v(n.value.length)+") ",1)]),_:1},8,["disabled"])])]),!n.value||n.value.length===0?(d(),c("div",Z,[s(o(F),{class:"max-w-md"},{default:a(()=>[s(o(C),null,{default:a(()=>[s(o(A),null,{default:a(()=>[...e[6]||(e[6]=[u("No PDFs Found",-1)])]),_:1}),s(o(U),null,{default:a(()=>[...e[7]||(e[7]=[u("No PDFs were found. Please generate PDFs first.",-1)])]),_:1})]),_:1}),s(o(L),null,{default:a(()=>[s(o(g),{onClick:k,class:"w-full"},{default:a(()=>[s(o(j),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=u(" Go Back to PDF Templates ",-1))]),_:1})]),_:1})]),_:1})])):(d(),c("div",ee,[s(o(F),{class:"w-64 flex-shrink-0 flex flex-col overflow-hidden"},{default:a(()=>[s(o(C),null,{default:a(()=>[s(o(A),null,{default:a(()=>[...e[9]||(e[9]=[u("Generated PDFs",-1)])]),_:1}),s(o(U),null,{default:a(()=>[u(v(n.value.length)+" PDF"+v(n.value.length!==1?"s":"")+" generated",1)]),_:1})]),_:1}),s(o(L),{class:"flex-1 overflow-auto min-h-0"},{default:a(()=>[!n.value||n.value.length===0?(d(),c("div",te,[e[11]||(e[11]=r("p",null,"No PDFs available",-1)),s(o(g),{variant:"outline",onClick:k,class:"mt-4"},{default:a(()=>[s(o(j),{class:"mr-2 h-4 w-4"}),e[10]||(e[10]=u(" Go Back ",-1))]),_:1})])):(d(),c("div",le,[(d(!0),c(S,null,V(n.value,(l,f)=>(d(),c("div",{key:f,class:z(["p-3 border rounded cursor-pointer transition-colors",w.value===f?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"]),onClick:h=>E(f)},[r("div",oe,[r("div",ae,[r("p",re,v(l.filename),1),r("p",ne," PDF #"+v(l.index),1)]),s(o(g),{variant:"ghost",size:"sm",onClick:G(h=>P(l),["stop"]),class:"ml-2"},{default:a(()=>[s(o($),{class:"h-4 w-4"})]),_:1},8,["onClick"])])],10,se))),128))]))]),_:1})]),_:1}),r("div",de,[s(o(F),{class:"h-full flex flex-col overflow-hidden"},{default:a(()=>[s(o(C),null,{default:a(()=>[s(o(A),null,{default:a(()=>[u(v(i.value?.filename||"No PDF Selected"),1)]),_:1}),i.value?(d(),M(o(U),{key:0},{default:a(()=>[u(" PDF "+v(w.value+1)+" of "+v(n.value.length),1)]),_:1})):H("",!0)]),_:1}),s(o(L),{class:"flex-1 overflow-auto min-h-0"},{default:a(()=>[i.value?(d(),c("div",ce,[r("div",ue,[b.value?(d(),c("iframe",{key:0,src:b.value,class:"w-full h-full border-0",onError:e[1]||(e[1]=l=>{console.error("PDF iframe error:",l)})},null,40,fe)):i.value.base64?(d(),c("iframe",{key:1,src:`data:application/pdf;base64,${i.value.base64}`,class:"w-full h-full border-0",onError:e[2]||(e[2]=l=>{console.error("PDF iframe error:",l)})},null,40,me)):i.value.base64?(d(),c("object",{key:2,data:`data:application/pdf;base64,${i.value.base64}`,type:"application/pdf",class:"w-full h-full border-0"},[r("div",ve,[r("p",null,[e[13]||(e[13]=u(" PDF cannot be displayed. ",-1)),r("a",{href:`data:application/pdf;base64,${i.value.base64}`,download:i.value.filename,class:"text-blue-500 underline ml-2"}," Download instead ",8,be)])])],8,pe)):(d(),c("div",he,[...e[14]||(e[14]=[r("p",null,"PDF data is missing",-1)])]))])])):(d(),c("div",ie,[...e[12]||(e[12]=[r("p",null,"No PDF selected",-1)])]))]),_:1})]),_:1})])]))])]),_:1})],64))}});export{Ne as default};
